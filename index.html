<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>健身记录器</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<style>
  :root {
    --bg: #ffffff;
    --fg: #111827;
    --accent: #10b981;
    --accent-danger: #ef4444;
    --accent-warning: #f59e0b;
    --card-bg: #f9fafb;
    --border: #e5e7eb;
    --muted: #6b7280;
    --font: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
  }

  body {
    margin: 0;
    padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom);
    font-family: var(--font);
    background: var(--bg);
    color: var(--fg);
  }

  .page { display: none; }
  .page.active { display: block; }

  .app { max-width: 480px; margin: 0 auto; }

  h1 {
    font-size: 20px;
    margin: 12px 0 16px;
    text-align: center;
  }

  .card {
    background: var(--card-bg);
    border-radius: 14px;
    padding: 12px 14px;
    border: 1px solid var(--border);
    margin-bottom: 12px;
  }

  .label {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 4px;
  }

input[type="date"] {
  -webkit-appearance: none; /* ← 关键 */
}

input[type="date"],
select {
  width: 92%;            /* ← 控件缩小（你可改成 60%、65%、80%） */
  padding: 8px 10px;     /* ← 保持原高度 */
  border-radius: 10px;
  border: 1px solid var(--border);
  background: #ffffff;
  color: var(--fg);
  font-size: 15px;       /* ← 字体大小不变 */

  display: block;        /* ← 让 margin auto 生效 */
  margin: 0 auto;        /* ← 控件整体居中 */
  text-align: center;    /* ← 字体在控件内部居中 */
}

  select {
    width: 100%;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #ffffff;
    color: var(--fg);
    font-size: 15px;
  }

  button {
    font-family: var(--font);
    border: none;
    border-radius: 999px;
    padding: 6px 14px;
    font-size: 16px;
    font-weight: 500;
    color: #ffffff;
    background: var(--accent);
    min-width: 40px;
  }

  button.small { padding: 4px 10px; font-size: 13px; }
  button.danger { background: var(--accent-danger); }
  button.warning { background: var(--accent-warning); color: #111827; }

  .row { display: flex; align-items: center; gap: 8px; }
  .row-space { display: flex; justify-content: space-between; align-items: center; }

  .history-item {
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
  }
</style>
</head>
<body>

<div class="app">

<!-- ------------------ 首页：当天训练 ------------------ -->
<div id="page-home" class="page active">
  <h1>今日训练</h1>

  <div class="card">
    <div class="label">日期</div>
    <input type="date" id="datePicker">
  </div>

  <div class="card">
    <div class="label">项目</div>
    <select id="workoutSelect"></select>
  </div>

  <div class="card">
    <div class="row-space">
      <div>
        <div class="label">当前记录</div>
        <div id="countLabel">组数：0</div>
        <div id="totalLabel" style="color:var(--muted)">总计：0 个</div>
      </div>
      <div class="row">
        <button id="subBtn">-</button>
        <button id="addBtn">+</button>
      </div>
    </div>

    <!-- 删除当前项目按钮 -->
    <button id="deleteItemBtn" class="danger small" style="margin-top:10px; display:none;">
      删除该项目数据
    </button>
  </div>

  <div class="card">
    <button class="warning small" id="clearTodayBtn">清除当天全部数据</button>
  </div>

  <div class="card">
    <button id="gotoHistory">查看历史记录</button>
  </div>
</div>

<!-- ------------------ 历史记录页 ------------------ -->
<div id="page-history" class="page">
  <h1>历史记录</h1>

  <div id="historyList"></div>

  <div class="card">
    <button id="backHome">返回今日训练</button>
  </div>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const WORKOUTS = {
    "对握下拉": 10,
    "卧推": 8,
    "深蹲": 12,
    "硬拉": 5,
    "哑铃弯举": 12,
  };

  const STORAGE_KEY = "fitness_history_v3";
  let history = {};
  let currentCount = 0;

  const pageHome = document.getElementById("page-home");
  const pageHistory = document.getElementById("page-history");

  const datePicker = document.getElementById("datePicker");
  const workoutSelect = document.getElementById("workoutSelect");
  const countLabel = document.getElementById("countLabel");
  const totalLabel = document.getElementById("totalLabel");

  const addBtn = document.getElementById("addBtn");
  const subBtn = document.getElementById("subBtn");
  const deleteItemBtn = document.getElementById("deleteItemBtn");
  const clearTodayBtn = document.getElementById("clearTodayBtn");

  const gotoHistory = document.getElementById("gotoHistory");
  const backHome = document.getElementById("backHome");

  const historyList = document.getElementById("historyList");

  function todayStr() {
    const d = new Date();
    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  }

  function loadStorage() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) history = JSON.parse(raw);
  }

  function saveStorage() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
  }

  function getDateKey() {
    return datePicker.value || todayStr();
  }

  function loadCurrent() {
    const dateKey = getDateKey();
    const item = workoutSelect.value;

    currentCount = history[dateKey]?.[item] ?? 0;

    updateDisplay();
    deleteItemBtn.style.display = currentCount > 0 ? "block" : "none";
  }

  function updateDisplay() {
    const item = workoutSelect.value;
    const per = WORKOUTS[item];
    countLabel.textContent = `组数：${currentCount}`;
    totalLabel.textContent = `总计：${currentCount * per} 个`;
  }

  function saveCurrent() {
    const dateKey = getDateKey();
    const item = workoutSelect.value;

    if (!history[dateKey]) history[dateKey] = {};

    // 自动删除：组数为 0
    if (currentCount === 0) {
      delete history[dateKey][item];

      if (Object.keys(history[dateKey]).length === 0) {
        delete history[dateKey];
      }

      saveStorage();
      deleteItemBtn.style.display = "none";
      return;
    }

    history[dateKey][item] = currentCount;
    saveStorage();
    deleteItemBtn.style.display = "block";
  }

  deleteItemBtn.onclick = () => {
    const dateKey = getDateKey();
    const item = workoutSelect.value;

    if (history[dateKey]) {
      delete history[dateKey][item];
      if (Object.keys(history[dateKey]).length === 0) delete history[dateKey];
    }

    saveStorage();
    currentCount = 0;
    updateDisplay();
    deleteItemBtn.style.display = "none";
  };

  clearTodayBtn.onclick = () => {
    const dateKey = getDateKey();
    delete history[dateKey];
    saveStorage();
    currentCount = 0;
    updateDisplay();
    deleteItemBtn.style.display = "none";
  };

  addBtn.onclick = () => {
    currentCount++;
    updateDisplay();
    saveCurrent();
  };

  subBtn.onclick = () => {
    if (currentCount > 0) currentCount--;
    updateDisplay();
    saveCurrent();
  };

  datePicker.onchange = loadCurrent;
  workoutSelect.onchange = loadCurrent;

  function renderHistoryPage() {
    historyList.innerHTML = "";

    const dates = Object.keys(history).sort();
    if (dates.length === 0) {
      historyList.innerHTML = "<div class='card'>暂无记录</div>";
      return;
    }

    dates.forEach(dateKey => {
      const card = document.createElement("div");
      card.className = "card";

      const title = document.createElement("div");
      title.innerHTML = `<strong>${dateKey}</strong>`;
      card.appendChild(title);

      const items = history[dateKey];

      Object.keys(items).forEach(item => {
        const row = document.createElement("div");
        row.className = "history-item";

        const per = WORKOUTS[item];
        const count = items[item];

        row.innerHTML = `
          <div><strong>${item}</strong>：${count} 组（共 ${count * per} 个）</div>
          <div class="row" style="margin-top:6px;">
            <button class="small" data-date="${dateKey}" data-item="${item}" data-op="-">-</button>
            <button class="small" data-date="${dateKey}" data-item="${item}" data-op="+">+</button>
          </div>
        `;

        card.appendChild(row);
      });

      const delBtn = document.createElement("button");
      delBtn.textContent = "删除当天数据";
      delBtn.className = "danger small";
      delBtn.style.marginTop = "8px";
      delBtn.onclick = () => {
        delete history[dateKey];
        saveStorage();
        renderHistoryPage();
      };

      card.appendChild(delBtn);
      historyList.appendChild(card);
    });

    historyList.querySelectorAll("button[data-op]").forEach(btn => {
      btn.onclick = () => {
        const dateKey = btn.dataset.date;
        const item = btn.dataset.item;
        const op = btn.dataset.op;

        if (op === "+") history[dateKey][item]++;
        else if (op === "-" && history[dateKey][item] > 0) history[dateKey][item]--;

        if (history[dateKey][item] === 0) delete history[dateKey][item];
        if (Object.keys(history[dateKey]).length === 0) delete history[dateKey];

        saveStorage();
        renderHistoryPage();
      };
    });
  }

  gotoHistory.onclick = () => {
    renderHistoryPage();
    pageHome.classList.remove("active");
    pageHistory.classList.add("active");
  };

  backHome.onclick = () => {
    pageHistory.classList.remove("active");
    pageHome.classList.add("active");
  };

  function init() {
    loadStorage();

    for (const name in WORKOUTS) {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = `${name}（每组 ${WORKOUTS[name]} 个）`;
      workoutSelect.appendChild(opt);
    }

    datePicker.value = todayStr();
    loadCurrent();
  }

  init();
});
</script>

<div>
  — Designed by BY —
</div>

</body>
</html>
